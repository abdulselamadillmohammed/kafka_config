<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Orders Viewer</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: ui-sans-serif, -apple-system, Segoe UI, Roboto, sans-serif; margin: 2rem; }
    h1 { margin: 0 0 .5rem; }
    #status { color: #666; margin-bottom: 1rem; }
    li { padding: .3rem 0; }
    .p0 { color: #0b6; } .p1 { color: #06c; } .px { color:#444; }
  </style>
</head>
<body>
  <h1>Orders Processed</h1>
  <div id="status">connecting…</div>
  <ul id="orders"></ul>

  <script>
    const statusEl = document.getElementById('status');
    const listEl = document.getElementById('orders');
    const es = new EventSource('/orders-stream');

    es.onopen = () => statusEl.textContent = 'live (connected)';
    es.onerror = () => statusEl.textContent = 'disconnected (retrying…)';

    es.onmessage = (evt) => {
      try {
        const e = JSON.parse(evt.data);
        const li = document.createElement('li');
        li.className = `p${e.partition ?? 'x'}`;
        const amt = e.amount !== undefined ? `$${e.amount}` : '';
        const id  = e.orderId !== undefined ? `#${e.orderId}` : '';
        const ts  = e.at || new Date().toISOString();
        li.textContent = `p${e.partition} • Order ${id} • ${amt} • ${ts}`;
        listEl.prepend(li);
      } catch {}
    };
  </script>
</body>
</html>
